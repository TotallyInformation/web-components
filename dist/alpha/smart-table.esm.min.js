var c=class d extends HTMLElement{static baseVersion="2024-10-06";static _iCount=0;uib=!!window.uibuilder;$;$$;connected=!1;name;opts={};static get version(){return`${this.componentVersion} (Base: ${this.baseVersion})`}constructor(){super()}async doInheritStyles(){if(!this.hasAttribute("inherit-style"))return;let e=this.getAttribute("inherit-style");e||(e="./index.css");let t=document.createElement("link");t.setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),this.shadowRoot.appendChild(t),console.info(`[${this.localName}] Inherit-style requested. Loading: "${e}"`)}config(e){return e&&(this.opts=d.deepAssign(this.opts,e)),this.opts}static deepAssign(e,...t){for(let s of t)for(let n in s){let i=s[n],o=e[n];if(Object(i)==i&&Object(o)===o){e[n]=d.deepAssign(o,i);continue}e[n]=s[n]}return e}ensureId(){this.uib=!!window.uibuilder,this.id||(this.id=`${this.localName}-${++this.constructor._iCount}`)}createShadowSelectors(){this.$=this.shadowRoot?.querySelector.bind(this.shadowRoot),this.$$=this.shadowRoot?.querySelectorAll.bind(this.shadowRoot)}_uibMsgHandler(e){}_event(e,t){this.dispatchEvent(new CustomEvent(`${this.localName}:${e}`,{bubbles:!0,composed:!0,detail:{id:this.id,name:this.name,data:t}}))}_construct(e,t){t||(t={mode:"open",delegatesFocus:!0}),this.attachShadow(t).append(e),this.createShadowSelectors()}_connect(){this.ensureId(),this.doInheritStyles()}_disconnect(){document.removeEventListener(`uibuilder:msg:_ui:update:${this.id}`,this._uibMsgHandler),this._event("disconnected")}_ready(){this.connected=!0,this._event("connected"),this._event("ready")}},u=c;var l=class extends u{static componentVersion="2024-10-06";static get observedAttributes(){return["inherit-style","name"]}#e;#t;elThead;elTfoot;elTbody;set data(e){e!==null&&e!==this.#e&&(this.#e=this._createProxy(e),this.#t||this._buildCols(!0),this._buildHeadings(),this._buildRows())}get data(){return this.#e}constructor(){super()}connectedCallback(){this._connect(),this._buildTblOutline(),this._ready()}disconnectedCallback(){this._disconnect()}attributeChangedCallback(e,t,s){this.connected&&t!==s&&(this[e]=s,this._event("attribChanged",{attribute:e,newVal:s,oldVal:t}))}getValueByOffset(e,t,s){let n=Object.keys(e),i=Object.keys(e[n[t]]),o=n[t],a=i[s];return e[o][a]}getCellById(e){let t=this.elTbody.querySelector(`td[data-cell="${e}"]`);return t||console.warn(`[${this.localName}:getCellById:${this.id}] Invalid cell reference "${e}"`),t}getValueByCellId(e){let[,t,s]=e.split(/^R(\d+)C(\d+)$/ig);return t=Number(t)-1,s=Number(s)-1,Number.isNaN(t)||Number.isNaN(s)?(console.warn(`[${this.localName}:getValueByCellId:${this.id}] Invalid cell reference "${e}"`),null):this.getValueByOffset(this.#e,t,s)}_createProxy(e,t=null){return new Proxy(e,{get:(s,n)=>{let i=s[n];return Array.isArray(i)||typeof i=="object"&&i!==null?t!==null?(console.warn(`[${this.localName}:_createProxy:${this.id}] Data is >2d. Can only deal with 2d (tabular) data.`),i):this._createProxy(i,n):i},set:(s,n,i)=>{let o=!(n in s);return s[n]=i,o?this._onDataChange(t,n,i,"added"):this._onDataChange(t,n,i,"modified"),!0},deleteProperty:(s,n)=>{let i=s[n],o=delete s[n];return o&&this._onDataChange(t,n,i,"deleted"),o}})}_onDataChange(e,t,s,n){this.elThead.replaceChildren(""),this.elTfoot.replaceChildren(""),this.elTbody.replaceChildren(""),this.#t||this._buildCols(!0),this._buildHeadings(),this._buildRows()}_buildTblOutline(){let e=document.createElement("table");e.innerHTML=`
        <thead></thead>
        <tfoot></tfoot>
        <tbody></tbody>
        `,this.prepend(e),this.elThead=e.getElementsByTagName("thead")[0],this.elTfoot=e.getElementsByTagName("tfoot")[0],this.elTbody=e.getElementsByTagName("tbody")[0]}_buildCols(e){this.#t={};let t=this.#e[Object.keys(this.#e)[0]];Array.isArray(t)?t.forEach((s,n)=>{let i=`C${n+1}`;this.#t[i]={id:i,name:`Column ${n+1}`,type:typeof s,title:void 0}}):Object.keys(t).forEach(s=>{this.#t[s]={id:s,name:s,type:typeof s,title:void 0}})}_buildHeadings(){let e="H1R1",t=document.createElement("tr");t.dataset.row=e,Object.keys(this.#t).forEach((s,n)=>{let i=document.createElement("th");i.dataset.row=e,i.dataset.col=this.#t[s].id,i.innerText=this.#t[s].name,t.appendChild(i)}),this.elThead.appendChild(t)}_buildRows(){Object.keys(this.#e).forEach((e,t)=>{this._buildRow(t,e,this.#e[e])})}_buildRow(e,t,s){let n=Number(t),i=Number.isNaN(n)?t:`R${n+1}`,o=document.createElement("tr");o.dataset.row=i,Object.keys(this.#t).forEach((a,h)=>{let r=document.createElement("td");r.dataset.row=i,r.dataset.col=this.#t[a].id,r.dataset.cell=`R${e+1}C${h+1}`,r.innerText=this.#e[t][a]===void 0?this.#e[e][h]:this.#e[t][a],o.appendChild(r)}),this.elTbody.appendChild(o)}},m=l;window.SmartTable=l;customElements.define("smart-table",l);export{m as default};
//# sourceMappingURL=smart-table.esm.min.js.map
