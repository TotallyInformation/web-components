var c=class l extends HTMLElement{static baseVersion="2025-06-03";static _iCount=0;uib=!!window.uibuilder;uibuilder=window.uibuilder;$;$$;connected=!1;name;opts={};static get version(){return`${this.componentVersion} (Base: ${this.baseVersion})`}constructor(){super()}config(e){return e&&(this.opts=l.deepAssign(this.opts,e)),this.opts}createShadowSelectors(){this.$=this.shadowRoot?.querySelector.bind(this.shadowRoot),this.$$=this.shadowRoot?.querySelectorAll.bind(this.shadowRoot)}static deepAssign(e,...t){for(let i of t)for(let s in i){let n=i[s],o=e[s];if(Object(n)==n&&Object(o)===o){e[s]=l.deepAssign(o,n);continue}e[s]=i[s]}return e}async doInheritStyles(){if(!this.shadowRoot||!this.hasAttribute("inherit-style"))return;let e=this.getAttribute("inherit-style");e||(e="./index.css");let t=document.createElement("link");t.setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),this.shadowRoot.appendChild(t),console.info(`[${this.localName}] Inherit-style requested. Loading: "${e}"`)}ensureId(){this.uib=!!window.uibuilder,this.id||(this.id=`${this.localName}-${++this.constructor._iCount}`)}prependStylesheet(e,t=0){if(!e)throw new Error(`[${this.localName}] cssText must be provided`);let i=this._findExistingStylesheet();if(i)return i;let s=document.createElement("style");return s.textContent=e,s.setAttribute("data-component",this.localName),s.setAttribute("data-order",t.toString()),this._prependToDocumentHead(s,t),s}uibSend(e,t){this.uib&&(this.uibuilder.ioConnected?this.uibuilder.send({topic:`${this.localName}:${e}`,payload:t,id:this.id,name:this.name}):console.warn(`[${this.localName}] uibuilder not connected to server, cannot send:`,e,t))}_connect(){this.ensureId(),this.doInheritStyles(),this.uib&&this.uibuilder.onTopic(`${this.localName}::${this.id}`,this._uibMsgHandler.bind(this))}_construct(e,t){e&&(t||(t={mode:"open",delegatesFocus:!0}),this.attachShadow(t).append(e),this.createShadowSelectors())}_disconnect(){document.removeEventListener(`uibuilder:msg:_ui:update:${this.id}`,this._uibMsgHandler),this._event("disconnected")}_event(e,t){this.dispatchEvent(new CustomEvent(`${this.localName}:${e}`,{bubbles:!0,composed:!0,detail:{id:this.id,name:this.name,data:t}}))}_ready(){this.connected=!0,this._event("connected"),this._event("ready")}_uibMsgHandler(e){if(typeof e.payload!="object"){console.warn(`[${this.localName}] Ignoring msg, payload is not an object:`,e);return}Object.keys(e.payload).forEach(t=>{t.startsWith("_")||(this[t]=e.payload[t])})}_findExistingStylesheet(){return document.head.querySelector(`style[data-component="${this.localName}"]`)}_prependToDocumentHead(e,t){let i=document.head,s=Array.from(i.querySelectorAll("style[data-component]"));if(s.length===0){let o=i.firstChild;o?i.insertBefore(e,o):i.appendChild(e);return}let n=null;for(let o of s){let r=parseInt(o.getAttribute("data-order")??"0",10);if(t<r){n=o;break}}if(n)i.insertBefore(e,n);else{let r=s[s.length-1].nextSibling;r?i.insertBefore(e,r):i.appendChild(e)}}},u=c;var d=class extends u{static componentVersion="2024-10-06";static get observedAttributes(){return["inherit-style","name"]}#e;#t;elThead;elTfoot;elTbody;set data(e){e!==null&&e!==this.#e&&(this.#e=this._createProxy(e),this.#t||this._buildCols(!0),this._buildHeadings(),this._buildRows())}get data(){return this.#e}constructor(){super()}connectedCallback(){this._connect(),this._buildTblOutline(),this._ready()}disconnectedCallback(){this._disconnect()}attributeChangedCallback(e,t,i){this.connected&&t!==i&&(this[e]=i,this._event("attribChanged",{attribute:e,newVal:i,oldVal:t}))}getValueByOffset(e,t,i){let s=Object.keys(e),n=Object.keys(e[s[t]]),o=s[t],r=n[i];return e[o][r]}getCellById(e){let t=this.elTbody.querySelector(`td[data-cell="${e}"]`);return t||console.warn(`[${this.localName}:getCellById:${this.id}] Invalid cell reference "${e}"`),t}getValueByCellId(e){let[,t,i]=e.split(/^R(\d+)C(\d+)$/ig);return t=Number(t)-1,i=Number(i)-1,Number.isNaN(t)||Number.isNaN(i)?(console.warn(`[${this.localName}:getValueByCellId:${this.id}] Invalid cell reference "${e}"`),null):this.getValueByOffset(this.#e,t,i)}_createProxy(e,t=null){return new Proxy(e,{get:(i,s)=>{let n=i[s];return Array.isArray(n)||typeof n=="object"&&n!==null?t!==null?(console.warn(`[${this.localName}:_createProxy:${this.id}] Data is >2d. Can only deal with 2d (tabular) data.`),n):this._createProxy(n,s):n},set:(i,s,n)=>{let o=!(s in i);return i[s]=n,o?this._onDataChange(t,s,n,"added"):this._onDataChange(t,s,n,"modified"),!0},deleteProperty:(i,s)=>{let n=i[s],o=delete i[s];return o&&this._onDataChange(t,s,n,"deleted"),o}})}_onDataChange(e,t,i,s){this.elThead.replaceChildren(""),this.elTfoot.replaceChildren(""),this.elTbody.replaceChildren(""),this.#t||this._buildCols(!0),this._buildHeadings(),this._buildRows()}_buildTblOutline(){let e=document.createElement("table");e.innerHTML=`
        <thead></thead>
        <tfoot></tfoot>
        <tbody></tbody>
        `,this.prepend(e),this.elThead=e.getElementsByTagName("thead")[0],this.elTfoot=e.getElementsByTagName("tfoot")[0],this.elTbody=e.getElementsByTagName("tbody")[0]}_buildCols(e){this.#t={};let t=this.#e[Object.keys(this.#e)[0]];Array.isArray(t)?t.forEach((i,s)=>{let n=`C${s+1}`;this.#t[n]={id:n,name:`Column ${s+1}`,type:typeof i,title:void 0}}):Object.keys(t).forEach(i=>{this.#t[i]={id:i,name:i,type:typeof i,title:void 0}})}_buildHeadings(){let e="H1R1",t=document.createElement("tr");t.dataset.row=e,Object.keys(this.#t).forEach((i,s)=>{let n=document.createElement("th");n.dataset.row=e,n.dataset.col=this.#t[i].id,n.innerText=this.#t[i].name,t.appendChild(n)}),this.elThead.appendChild(t)}_buildRows(){Object.keys(this.#e).forEach((e,t)=>{this._buildRow(t,e,this.#e[e])})}_buildRow(e,t,i){let s=Number(t),n=Number.isNaN(s)?t:`R${s+1}`,o=document.createElement("tr");o.dataset.row=n,Object.keys(this.#t).forEach((r,h)=>{let a=document.createElement("td");a.dataset.row=n,a.dataset.col=this.#t[r].id,a.dataset.cell=`R${e+1}C${h+1}`,a.innerText=this.#e[t][r]===void 0?this.#e[e][h]:this.#e[t][r],o.appendChild(a)}),this.elTbody.appendChild(o)}},y=d;window.SmartTable=d;customElements.define("smart-table",d);export{y as default};
//# sourceMappingURL=smart-table.esm.min.js.map
